<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ============================================= -->
    <!-- SEO OPTIMIZATION STRATEGY (VENEZUELA / SST)   -->
    <!-- ============================================= -->
    
    <!-- Título Optimizado: Las palabras clave más importantes van primero -->
    <title>Directorio SST Venezuela: Profesionales LOPCYMAT y Prevención - La Movida de SST</title>
    
    <!-- Descripción: Resumen atractivo que incluye tus palabras clave objetivo -->
    <meta name="description" content="Directorio oficial de profesionales de Seguridad y Salud en el Trabajo (SST) en Venezuela. Encuentra asesoría SST, expertos en LOPCYMAT, Programas de Seguridad (PSST), NT04 y gestión ante INPSASEL.">
    
    <!-- Palabras Clave (Keywords) -->
    <meta name="keywords" content="SST Venezuela, LOPCYMAT, Prevención de Riesgos, Profesionales SST, Seguridad Industrial, Inpsasel, Salud Ocupacional, Directorio SST, DAO Network, Venezuela, Asesoría SST, Programa de Seguridad, PSST, NT04">
    
    <!-- Autor y Robots -->
    <meta name="author" content="La Movida de SST DAO Network">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.movidasst.com/">

    <!-- Geo-Targeting (Clave para búsquedas locales en Venezuela) -->
    <meta name="geo.region" content="VE">
    <meta name="geo.placename" content="Venezuela">
    
    <!-- ============================================= -->
    <!-- DATOS ESTRUCTURADOS (JSON-LD) para Google     -->
    <!-- ============================================= -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "La Movida de SST DAO Network",
      "url": "https://www.movidasst.com",
      "logo": "https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png",
      "description": "Comunidad y directorio de profesionales de Seguridad y Salud en el Trabajo, enfocados en LOPCYMAT y prevención de riesgos.",
      "areaServed": {
        "@type": "Country",
        "name": "Venezuela"
      },
      "knowsAbout": ["SST", "LOPCYMAT", "Seguridad Industrial", "Prevención de Riesgos", "Asesoría SST", "Programa de Seguridad", "PSST", "NT04"]
    }
    </script>

    <!-- METADATOS PARA REDES SOCIALES (Open Graph) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.movidasst.com/">
    <meta property="og:title" content="Directorio de Profesionales SST y LOPCYMAT - Venezuela">
    <meta property="og:description" content="Encuentra y conecta con los mejores expertos en prevención de riesgos y seguridad laboral de nuestra comunidad.">
    <meta property="og:image" content="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png">
    <meta property="og:locale" content="es_VE">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Directorio SST Venezuela - La Movida de SST">
    <meta name="twitter:description" content="Base de datos de profesionales en LOPCYMAT y Seguridad Industrial.">
    <meta name="twitter:image" content="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #f0fdf4; }
        
        /* Scrollbar refinado */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Animaciones Suaves */
        .pro-card {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }
        .pro-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -10px rgba(0, 176, 80, 0.15);
            border-color: #86efac;
        }

        /* Modal Transitions */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }

        /* Branding Colors */
        .bg-brand { background-color: #00b050; }
        .text-brand { color: #00b050; }
        .border-brand { border-color: #00b050; }
        .hover-bg-brand-dark:hover { background-color: #008f41; }
        
        /* Fondo Sutil Tech */
        .bg-pattern {
            background-color: #f8fafc;
            background-image: linear-gradient(rgba(0, 176, 80, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 176, 80, 0.03) 1px, transparent 1px);
            background-size: 32px 32px;
        }

        .tech-grid {
            background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Utilidad para ocultar scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Tooltip simple para el copiado */
        #copyTooltip {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden bg-pattern selection:bg-green-100 selection:text-green-900">

    <!-- ENCABEZADO DE MARCA -->
    <header class="bg-white/90 backdrop-blur-md border-b border-slate-200 z-40 relative shadow-sm flex-shrink-0">
        <div class="max-w-7xl mx-auto px-4 md:px-8 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                
                <!-- Identidad -->
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <a href="https://www.movidasst.com" target="_blank" class="flex-shrink-0 hover:opacity-90 transition-opacity">
                        <img src="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png" alt="Logo Movida SST" class="w-16 h-16 md:w-20 md:h-20 object-contain drop-shadow-sm">
                    </a>
                    <div class="flex flex-col">
                        <h1 class="text-lg md:text-xl font-extrabold text-slate-900 leading-none tracking-tight">
                            La Movida de SST <span class="text-brand">DAO Network</span>
                        </h1>
                        <p class="text-[10px] md:text-xs font-medium text-slate-500 uppercase tracking-widest mt-1">Directorio Oficial</p>
                    </div>
                </div>

                <!-- Acciones -->
                <div class="flex items-center gap-3 md:gap-6 w-full md:w-auto justify-between md:justify-end border-t md:border-t-0 border-slate-100 pt-3 md:pt-0">
                    <div class="hidden lg:flex items-center gap-2 border-r border-slate-200 pr-4">
                        <span id="status-dot" class="w-2 h-2 rounded-full bg-slate-300"></span>
                        <span id="status-text" class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Iniciando</span>
                    </div>

                    <div class="flex gap-4 text-xs text-slate-500 md:border-r border-slate-200 md:pr-6">
                        <div class="text-center">
                            <span id="stat-total" class="block font-bold text-slate-900 text-lg leading-none">0</span>
                            <span class="text-[9px] uppercase font-bold tracking-wider text-slate-400">Miembros</span>
                        </div>
                        <div class="text-center">
                            <span id="stat-countries" class="block font-bold text-slate-900 text-lg leading-none">0</span>
                            <span class="text-[9px] uppercase font-bold tracking-wider text-slate-400">Países</span>
                        </div>
                    </div>
                    
                    <button onclick="forceSync()" class="flex items-center gap-2 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 hover:border-brand hover:text-brand px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all shadow-sm active:scale-95 group">
                        <svg class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span class="hidden sm:inline">Sincronizar</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- BARRA DE FILTROS -->
    <div class="bg-white border-b border-slate-200 z-30 sticky top-0 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 md:px-8 py-3">
            <div class="flex flex-col md:flex-row gap-3 items-center">
                <div class="relative flex-grow w-full md:w-auto group">
                    <svg class="absolute left-3.5 top-2.5 h-5 w-5 text-slate-400 group-focus-within:text-brand transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" id="searchInput" placeholder="Buscar por nombre, especialidad..." class="pl-11 w-full py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 focus:bg-white outline-none transition-all text-slate-700 placeholder:text-slate-400">
                </div>
                
                <div class="flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0 scrollbar-hide">
                    <select id="countryFilter" class="flex-1 md:flex-none w-32 py-2 px-3 bg-white border border-slate-200 rounded-xl text-xs font-semibold text-slate-600 focus:ring-2 focus:ring-green-500 outline-none cursor-pointer hover:border-brand transition-colors">
                        <option value="Todos">País: Todos</option>
                    </select>
                    <select id="stateFilter" class="flex-1 md:flex-none w-32 py-2 px-3 bg-white border border-slate-200 rounded-xl text-xs font-semibold text-slate-600 focus:ring-2 focus:ring-green-500 outline-none cursor-pointer hover:border-brand transition-colors">
                        <option value="Todos">Estado: Todos</option>
                    </select>
                    <select id="specialtyFilter" class="flex-1 md:flex-none w-40 py-2 px-3 bg-white border border-slate-200 rounded-xl text-xs font-semibold text-slate-600 focus:ring-2 focus:ring-green-500 outline-none cursor-pointer hover:border-brand transition-colors">
                        <option value="Todos">Profesión: Todas</option>
                    </select>
                    
                    <button id="resetFiltersBtn" onclick="resetFilters()" class="hidden bg-red-50 text-red-500 border border-red-100 hover:bg-red-100 px-3 py-2 rounded-xl transition-colors" title="Limpiar Filtros" aria-label="Limpiar Filtros">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENIDO -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 relative">
        <div class="max-w-7xl mx-auto pb-20"> 
            
            <!-- Banner Minimalista -->
            <div class="mb-6 bg-gradient-to-r from-emerald-500 to-green-600 rounded-2xl p-1 shadow-sm">
                <div class="bg-white rounded-xl p-4 flex flex-col sm:flex-row items-center justify-between gap-3">
                    <div class="flex items-center gap-3">
                        <div class="bg-green-100 p-2 rounded-full text-green-700">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                            </svg>
                        </div>
                        <p class="text-sm text-slate-700 font-medium">¿Quieres aparecer aquí? Únete al <span class="font-bold text-brand">Portal de Integrantes</span>.</p>
                    </div>
                    <a href="https://portal.movidasst.com/" target="_blank" class="whitespace-nowrap text-xs bg-slate-900 text-white px-5 py-2.5 rounded-lg font-bold hover:bg-slate-800 transition-transform active:scale-95 shadow-lg shadow-slate-200">Unirse Ahora</a>
                </div>
            </div>

            <!-- Grid -->
            <div id="gridContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>
            
            <!-- Cargar Más -->
            <div id="loadMoreContainer" class="mt-10 flex justify-center hidden">
                <button id="loadMoreBtn" class="bg-white text-slate-600 border border-slate-200 hover:border-brand hover:text-brand px-8 py-3 rounded-full text-xs font-bold shadow-sm transition-all active:scale-95 flex items-center gap-2 uppercase tracking-wide">
                    Ver más profesionales 
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
                </button>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20 text-slate-400">
                <div class="bg-white p-6 rounded-full mb-4 shadow-sm border border-slate-100">
                    <svg class="w-12 h-12 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <p class="text-lg font-semibold text-slate-600">No encontramos resultados</p>
                <p id="emptyStateSuggestion" class="text-sm mt-2 text-slate-500 bg-white border border-slate-200 px-4 py-1.5 rounded-full">Prueba con otros términos</p>
            </div>

            <!-- Loader -->
            <div id="loader" class="absolute inset-0 z-50 bg-white/90 backdrop-blur-sm flex flex-col gap-4 items-center justify-center transition-opacity duration-300">
                <div class="relative">
                    <div class="w-12 h-12 border-4 border-slate-100 border-t-brand rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="w-2 h-2 bg-brand rounded-full"></div>
                    </div>
                </div>
                <p class="text-xs font-bold text-slate-400 uppercase tracking-[0.2em] animate-pulse">Cargando Directorio</p>
            </div>
        </div>
    </main>

    <!-- MODAL REDISEÑADO TECH -->
    <div id="modalBackdrop" class="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-50 hidden flex items-center justify-center p-4 opacity-0 transition-all duration-300" onclick="closeModal()">
        
        <!-- Tarjeta Modal -->
        <div id="modalContent" class="bg-white rounded-3xl shadow-2xl w-full max-w-sm transform scale-95 transition-all duration-300 overflow-visible relative border border-slate-200 flex flex-col max-h-[90vh]" onclick="event.stopPropagation()">
            
            <!-- Cabecera Tech -->
            <div class="h-28 bg-slate-900 tech-grid relative z-10 p-4 flex justify-between items-start rounded-t-3xl border-b-2 border-brand">
                
                <!-- Botón COPIAR DATOS -->
                <div class="relative group">
                    <button onclick="copyProfileInfo()" class="text-white/70 hover:text-brand bg-white/10 hover:bg-white/20 p-2.5 rounded-full transition-all backdrop-blur-sm border border-white/10" title="Copiar Datos" aria-label="Copiar Datos de Contacto">
                        <!-- Icono Clipboard -->
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                    </button>
                    <!-- Tooltip "Copiado" (Oculto por defecto) -->
                    <div id="copyTooltip" class="absolute top-12 left-0 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded opacity-0 pointer-events-none transition-opacity">
                        ¡Copiado!
                    </div>
                </div>

                <!-- Botón Cerrar -->
                <button onclick="closeModal()" class="text-white/70 hover:text-white bg-white/10 hover:bg-red-500/80 p-2.5 rounded-full transition-all backdrop-blur-sm border border-white/10" aria-label="Cerrar Modal">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Contenido Principal -->
            <div class="px-6 pb-8 -mt-12 relative z-20 flex-1 overflow-y-auto no-scrollbar">
                
                <!-- Avatar Tech -->
                <div class="flex justify-center mb-4">
                    <div class="relative">
                        <div id="modalAvatarContainer" class="w-24 h-24 rounded-2xl border-4 border-slate-900 shadow-xl shadow-green-500/20 bg-white overflow-hidden z-10 relative"></div>
                        <!-- Efecto Glow -->
                        <div class="absolute inset-0 bg-brand blur-md rounded-2xl opacity-40 -z-10 transform translate-y-2"></div>
                    </div>
                </div>

                <!-- Datos Personales -->
                <div class="text-center mb-6">
                    <h3 class="text-xs font-extrabold text-brand uppercase tracking-widest mb-1">Profesional de SST</h3>
                    <h2 id="modalName" class="text-xl font-extrabold text-slate-800 leading-tight mb-2"></h2>
                    
                    <!-- Estatus Dinámico -->
                    <div class="flex justify-center mb-3">
                        <span id="modalStatus" class="px-3 py-1 rounded-full text-[10px] font-bold uppercase bg-slate-100 text-slate-500 border border-slate-200"></span>
                    </div>

                    <p id="modalProfession" class="text-xs font-bold text-slate-500 uppercase tracking-wider inline-block"></p>
                    
                    <div class="flex items-center justify-center gap-1.5 mt-3 text-slate-500 text-xs font-medium">
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span id="modalLocation"></span>
                    </div>
                </div>

                <!-- Botones de Acción (Estilo Tech) -->
                <div class="grid grid-cols-3 gap-3 mb-2">
                    <!-- Email -->
                    <a id="modalEmailBtn" href="#" class="flex flex-col items-center justify-center gap-2 p-3 rounded-2xl bg-white border border-slate-100 text-slate-600 hover:border-red-200 hover:bg-red-50 hover:text-red-600 transition-all group shadow-sm hover:shadow-md">
                        <svg class="w-6 h-6 text-slate-400 group-hover:text-red-500 transition-colors" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z" />
                            <path d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z" />
                        </svg>
                        <span class="text-[10px] font-bold uppercase tracking-wider">Email</span>
                    </a>

                    <!-- WhatsApp -->
                    <a id="modalWhatsappBtn" href="#" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-2xl bg-white border border-slate-100 text-slate-600 hover:border-green-200 hover:bg-green-50 hover:text-green-600 transition-all group shadow-sm hover:shadow-md">
                        <svg class="w-6 h-6 text-slate-400 group-hover:text-green-500 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                        </svg>
                        <span class="text-[10px] font-bold uppercase tracking-wider">WhatsApp</span>
                    </a>

                    <!-- LinkedIn -->
                    <a id="modalLinkedinBtn" href="#" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-2xl bg-white border border-slate-100 text-slate-600 hover:border-blue-200 hover:bg-blue-50 hover:text-blue-600 transition-all group shadow-sm hover:shadow-md">
                        <svg class="w-6 h-6 text-slate-400 group-hover:text-blue-500 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                        <span class="text-[10px] font-bold uppercase tracking-wider">LinkedIn</span>
                    </a>
                </div>
                
                <p id="modalNoContact" class="text-[10px] text-center text-slate-300 italic mb-4 hidden">Sin información de contacto</p>
            </div>
        </div>
    </div>

    <!-- BOTÓN VOLVER FLOTANTE -->
    <a href="https://www.movidasst.com" class="fixed bottom-6 right-6 z-50 bg-slate-900 hover:bg-brand text-white p-3 rounded-full shadow-xl hover:shadow-2xl transition-all hover:-translate-y-1 group border border-white/10" title="Volver al Inicio">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
    </a>

    <!-- SCRIPTS -->
    <script>
        const BASE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwAW5aTr0nD9K21AqiSlo9Ra2iSR8qN62ElA-J_VLSMiGT8P_vxsvl4nvCO77enmyu1Jg/exec';
        
        const CACHE_KEY = 'movida_directory_data';
        const CACHE_TIME_KEY = 'movida_directory_time';
        const CACHE_DURATION = 1000 * 60 * 30; // 30 minutos

        let allData = [];
        let filteredData = [];
        let displayedCount = 20;
        const LOAD_STEP = 20;
        let currentModalUser = null;

        // DEBOUNCE FUNCTION
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            
            // Apply debounce to search input
            document.getElementById('searchInput').addEventListener('input', debounce(applyFilters, 300));
            
            document.getElementById('countryFilter').addEventListener('change', handleCountryChange);
            document.getElementById('stateFilter').addEventListener('change', applyFilters);
            document.getElementById('specialtyFilter').addEventListener('change', applyFilters);
            document.getElementById('loadMoreBtn').addEventListener('click', () => {
                displayedCount += LOAD_STEP;
                renderGrid();
            });
        });

        async function initApp() {
            const cachedData = localStorage.getItem(CACHE_KEY);
            const cachedTime = localStorage.getItem(CACHE_TIME_KEY);
            const now = new Date().getTime();

            if (cachedData && cachedTime && (now - cachedTime < CACHE_DURATION)) {
                updateStatus("En línea");
                finalizeDataLoad(JSON.parse(cachedData));
            } else {
                loadFromURL();
            }
        }

        function forceSync() {
            localStorage.removeItem(CACHE_KEY);
            localStorage.removeItem(CACHE_TIME_KEY);
            loadFromURL();
        }

        async function loadFromURL() {
            const loader = document.getElementById('loader');
            if(loader) loader.classList.remove('hidden');
            updateStatus("Conectando...");
            
            try {
                const response = await fetch(`${BASE_SCRIPT_URL}?action=getDirectory`, { redirect: 'follow' });
                if (!response.ok) throw new Error(`HTTP: ${response.status}`);
                
                const json = await response.json();
                if (json.status === 'error') throw new Error(json.message);

                const data = json.data || [];
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
                localStorage.setItem(CACHE_TIME_KEY, new Date().getTime());

                finalizeDataLoad(data);

            } catch (err) {
                console.error(err);
                if(loader) loader.innerHTML = `<div class="bg-white p-4 rounded-xl text-red-500 font-bold shadow-lg border border-red-100">Error de conexión</div>`;
            }
        }

        function finalizeDataLoad(data) {
            processData(data);
            document.getElementById('loader').classList.add('hidden');
            updateStatus("Activo");
        }

        function updateStatus(msg) {
            const st = document.getElementById('status-text');
            const sd = document.getElementById('status-dot');
            if(st) st.textContent = msg;
            if(sd) sd.className = "w-2 h-2 rounded-full bg-brand animate-pulse";
        }

        function processData(data) {
            allData = data.map((item, idx) => {
                let photo = item.foto_url || "";
                if (photo.includes('drive.google.com')) {
                    const match = photo.match(/(?:id=|\/d\/)([a-zA-Z0-9_-]+)/);
                    if (match) photo = `https://drive.google.com/thumbnail?id=${match[1]}&sz=w400`;
                }
                return {
                    ...item,
                    id: idx,
                    nombre: item.nombre || 'Profesional',
                    profesion: item.profesion || 'General',
                    pais: item.pais || 'Desconocido',
                    estado: item.estado || '',
                    foto_url: photo,
                    email: String(item.email || ''),
                    whatsapp: String(item.whatsapp || ''),
                    linkedin: String(item.linkedin || ''),
                    status: item.status || 'Inactivo'
                };
            });
            updateDropdowns();
            applyFilters();
            document.getElementById('stat-total').textContent = allData.length;
            document.getElementById('stat-countries').textContent = new Set(allData.map(d=>d.pais).filter(Boolean)).size;
        }

        function updateDropdowns() {
            const populate = (id, list, label) => {
                const sel = document.getElementById(id);
                sel.innerHTML = `<option value="Todos">${label}</option>`;
                list.sort().forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item;
                    opt.textContent = item.length > 30 ? item.substring(0,30)+'...' : item;
                    sel.appendChild(opt);
                });
            };
            populate('countryFilter', [...new Set(allData.map(d=>d.pais).filter(Boolean))], 'País: Todos');
            populate('specialtyFilter', [...new Set(allData.map(d=>d.profesion).filter(Boolean))], 'Profesión: Todas');
            populate('stateFilter', [...new Set(allData.map(d=>d.estado).filter(Boolean))], 'Estado: Todos');
        }

        function handleCountryChange() {
            const country = document.getElementById('countryFilter').value;
            const filtered = country === 'Todos' ? allData : allData.filter(d => d.pais === country);
            const stateSel = document.getElementById('stateFilter');
            stateSel.innerHTML = '<option value="Todos">Estado: Todos</option>';
            [...new Set(filtered.map(d=>d.estado).filter(Boolean))].sort().forEach(s => {
                const opt = document.createElement('option');
                opt.value = s; opt.textContent = s;
                stateSel.appendChild(opt);
            });
            applyFilters();
        }

        function applyFilters() {
            displayedCount = 20;
            const term = document.getElementById('searchInput').value.toLowerCase();
            const country = document.getElementById('countryFilter').value;
            const state = document.getElementById('stateFilter').value;
            const prof = document.getElementById('specialtyFilter').value;

            document.getElementById('resetFiltersBtn').classList.toggle('hidden', !term && country === 'Todos' && state === 'Todos' && prof === 'Todos');

            filteredData = allData.filter(item => {
                const matchTerm = (item.nombre && item.nombre.toLowerCase().includes(term)) || 
                                  (item.profesion && item.profesion.toLowerCase().includes(term));
                const matchCountry = country === 'Todos' || item.pais === country;
                const matchState = state === 'Todos' || item.estado === state;
                const matchProf = prof === 'Todos' || item.profesion === prof;
                return matchTerm && matchCountry && matchState && matchProf;
            });
            renderGrid();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('countryFilter').value = 'Todos';
            document.getElementById('stateFilter').value = 'Todos';
            document.getElementById('specialtyFilter').value = 'Todos';
            handleCountryChange();
            applyFilters();
        }

        function getInitials(name) {
            return name ? name.split(' ').map(n=>n[0]).slice(0,2).join('').toUpperCase() : '??';
        }

        function renderGrid() {
            const grid = document.getElementById('gridContainer');
            grid.innerHTML = '';
            
            if(filteredData.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('loadMoreContainer').classList.add('hidden');
                return;
            }
            document.getElementById('emptyState').classList.add('hidden');

            const visible = filteredData.slice(0, displayedCount);
            
            visible.forEach(user => {
                const loc = [user.estado, user.pais].filter(Boolean).join(', ');
                const isActive = String(user.status).toLowerCase().trim() === 'activo';
                const statusColor = isActive ? 'bg-green-100 text-green-700 border-green-200' : 'bg-slate-100 text-slate-500 border-slate-200';
                
                const card = document.createElement('div');
                card.className = 'pro-card bg-white rounded-2xl p-5 pt-8 flex flex-col items-center text-center cursor-pointer group relative overflow-hidden shadow-sm hover:shadow-md';
                card.onclick = () => openModal(user);

                let avatar = `<div class="w-full h-full bg-slate-50 text-slate-300 flex items-center justify-center font-bold text-xl">${getInitials(user.nombre)}</div>`;
                if(user.foto_url) {
                    avatar = `<img src="${user.foto_url}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 img-loading" loading="lazy" onload="this.classList.remove('img-loading'); this.classList.add('img-loaded')" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full bg-slate-50 text-slate-300 flex items-center justify-center font-bold text-xl\\'>${getInitials(user.nombre)}</div>'">`;
                }

                card.innerHTML = `
                    <div class="absolute top-3 right-3">
                        <span class="px-2 py-0.5 rounded-md text-[9px] font-bold uppercase tracking-wider border ${statusColor}">
                            ${user.status || 'N/A'}
                        </span>
                    </div>
                    <div class="w-20 h-20 mb-3 relative">
                        <div class="w-full h-full rounded-2xl overflow-hidden shadow-sm bg-slate-50 border border-slate-100">${avatar}</div>
                    </div>
                    <h3 class="text-slate-900 font-bold text-base leading-tight line-clamp-1 group-hover:text-brand transition-colors mb-0.5" title="${user.nombre}">${user.nombre}</h3>
                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest mb-1">Profesional de SST</p>
                    <p class="text-[11px] font-medium text-brand line-clamp-1 mb-3">${user.profesion}</p>
                    <div class="mt-auto pt-3 border-t border-slate-50 flex items-center gap-1 text-slate-500 text-[10px] font-semibold uppercase tracking-wide">
                        <svg class="w-3 h-3 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span class="truncate">${loc}</span>
                    </div>
                `;
                grid.appendChild(card);
            });

            document.getElementById('loadMoreContainer').classList.toggle('hidden', filteredData.length <= displayedCount);
        }

        function openModal(user) {
            currentModalUser = user;
            const content = document.getElementById('modalContent');
            const backdrop = document.getElementById('modalBackdrop');

            document.getElementById('modalName').textContent = user.nombre;
            document.getElementById('modalProfession').textContent = user.profesion;
            document.getElementById('modalLocation').textContent = [user.estado, user.pais].filter(Boolean).join(', ');

            // Status dinámico en Modal
            const statusEl = document.getElementById('modalStatus');
            statusEl.textContent = user.status || 'Desconocido';
            const isActive = String(user.status).toLowerCase().trim() === 'activo';
            if (isActive) {
                statusEl.className = "px-3 py-1 rounded-full text-[10px] font-bold uppercase bg-green-100 text-green-700 border border-green-200";
            } else {
                statusEl.className = "px-3 py-1 rounded-full text-[10px] font-bold uppercase bg-slate-100 text-slate-500 border border-slate-200";
            }

            const avContainer = document.getElementById('modalAvatarContainer');
            avContainer.innerHTML = user.foto_url 
                ? `<img src="${user.foto_url}" class="w-full h-full object-cover img-loading" onload="this.classList.remove('img-loading'); this.classList.add('img-loaded')" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full bg-slate-50 text-slate-300 flex items-center justify-center font-bold text-2xl\\'>${getInitials(user.nombre)}</div>'">`
                : `<div class="w-full h-full bg-slate-50 text-slate-300 flex items-center justify-center font-bold text-2xl">${getInitials(user.nombre)}</div>`;

            const btnEmail = document.getElementById('modalEmailBtn');
            const btnWa = document.getElementById('modalWhatsappBtn');
            const btnLi = document.getElementById('modalLinkedinBtn');
            
            let hasContact = false;

            // Email Logic
            if(user.email && user.email.length > 3) {
                btnEmail.href = `mailto:${user.email}`;
                btnEmail.classList.remove('opacity-30', 'pointer-events-none');
                hasContact = true;
            } else {
                btnEmail.classList.add('opacity-30', 'pointer-events-none');
            }

            // WhatsApp Logic
            if(user.whatsapp && user.whatsapp.length > 5) {
                const num = user.whatsapp.replace(/\D/g, '');
                btnWa.href = `https://wa.me/${num}`;
                btnWa.classList.remove('opacity-30', 'pointer-events-none');
                hasContact = true;
            } else {
                btnWa.classList.add('opacity-30', 'pointer-events-none');
            }

            // LinkedIn Logic
            if(user.linkedin && user.linkedin.length > 5) {
                btnLi.href = user.linkedin.startsWith('http') ? user.linkedin : `https://${user.linkedin}`;
                btnLi.classList.remove('opacity-30', 'pointer-events-none');
                hasContact = true;
            } else {
                btnLi.classList.add('opacity-30', 'pointer-events-none');
            }

            document.getElementById('modalNoContact').classList.toggle('hidden', hasContact);

            backdrop.classList.remove('hidden');
            setTimeout(() => {
                backdrop.classList.remove('opacity-0');
                backdrop.classList.add('modal-enter-active');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const backdrop = document.getElementById('modalBackdrop');
            const content = document.getElementById('modalContent');
            backdrop.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            setTimeout(() => backdrop.classList.add('hidden'), 200);
        }

        // --- FUNCIONALIDAD SIMPLIFICADA DE COPIAR ---
        function copyProfileInfo() {
            // Verificar si hay usuario seleccionado (defensivo)
            if (!currentModalUser) return;
            
            // Construir texto limpio y ordenado
            const text = `
Nombre: ${currentModalUser.nombre}
Profesión: ${currentModalUser.profesion}
Estatus: ${currentModalUser.status}
Ubicación: ${[currentModalUser.estado, currentModalUser.pais].filter(Boolean).join(', ')}
Email: ${currentModalUser.email || 'N/A'}
WhatsApp: ${currentModalUser.whatsapp || 'N/A'}
            `.trim();
            
            // Método robusto de copiado (Clipboard API + Fallback)
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(showCopySuccess)
                    .catch(err => {
                        console.error('Fallo clipboard API', err);
                        fallbackCopy(text);
                    });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            // Asegurar que no sea visible pero esté en el DOM
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if(successful) showCopySuccess();
                else alert("No se pudo copiar. Intenta manualmente.");
            } catch (err) {
                console.error('Fallo fallback', err);
            }
            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            // Mostrar tooltip temporal
            const tooltip = document.getElementById('copyTooltip');
            if(tooltip) {
                tooltip.classList.remove('opacity-0');
                setTimeout(() => {
                    tooltip.classList.add('opacity-0');
                }, 2000);
            } else {
                alert("¡Datos copiados al portapapeles!");
            }
        }
    </script>
</body>
</html>
